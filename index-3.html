<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Stuff about stuff">
<meta name="viewport" content="width=device-width">
<title>Graham Wheeler's Random Forest (old posts, page 3) | Graham Wheeler's Random Forest</title>
<link href="assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="assets/css/code.css" rel="stylesheet" type="text/css">
<link href="assets/css/theme.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="assets/css/screen.css">
<link rel="stylesheet" type="text/css" href="assets/css/nav.css">
<link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic%7COpen+Sans:700,400%7CInconsolata">
<link href="assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/GrahamWheelersRandomForest">
<link rel="canonical" href="https://www.grahamwheeler.com/index-3.html">
<link rel="prev" href="index-4.html" type="text/html">
<link rel="next" href="index-2.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body class="nav-closed">

<div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
<li class="nav-opened" role="presentation">
            <a href="index.html">Home</a>
        </li>
        <li class="nav-opened" role="presentation">
            <a href="archive.html">Archives</a>
        </li>
        <li class="nav-opened" role="presentation">
            <a href="categories/index.html">Tags</a>
        </li>
        <li class="nav-opened" role="presentation">
            <a href="rss.xml">RSS</a>
        </li>
        <li class="nav-opened" role="presentation">
            <a href="https://twitter.com/gramnix">My Twitter</a>
        </li>
        <li class="nav-opened" role="presentation">
            <a href="https://github.com/gramster">My Github</a>
        </li>
        <li class="nav-opened" role="presentation">
            <a href="https://www.linkedin.com/in/grahamwheeler">My LinkedIn</a>
        </li>
    
    
    </ul>
</div>
<span class="nav-cover"></span>

<div class="site-wrapper">
    <header class="main-header" style="background-image: url(assets/img/IMG_5590.JPG)"><nav class="main-nav overlay clearfix"><a class="blog-logo" href="https://www.grahamwheeler.com/"><img src="https://getnikola.com/assets/img/logo.svg" alt="Blog Logo"></a>
            <a class="menu-button" href="#"><span class="burger">☰</span><span class="word">Menu</span></a>
        </nav><div class="vertical">
            <div class="main-header-content inner">
                <a href="https://github.com/gramster" target="_blank">
                    <span class="icon-github" style="color:white;font-size:2em"></span>
                </a>
                 
                <a class="bloglogo" href="https://twitter.com/gramnix" target="_blank">
                    <span class="icon-twitter" style="color:white;font-size:2em"></span>
                </a>
                 
                <h1 class="page-title">Graham Wheeler's Random Forest (old posts, page 3)</h1>
                <h2 class="page-description">Stuff about stuff</h2>
            </div>
        </div>
        <a class="scroll-down icon-arrow-left" href="#content"><span class="hidden">Scroll Down</span></a>
    </header><main id="content" class="content" role="main"><div class="postindex">


<article class="post post"><header class="post-header"><h2 class="post-title"><a href="posts/last-day-on-live-search-for-mobile.html">Last Day on Live Search for Mobile</a></h2>
    </header><section class="post-excerpt"><div>
<p>Today is my last official day on the Live Search for Mobile team. I am
moving over to a new team working on some incubating new mobile
initiatives in emerging markets (as a South African ex-pat I can relate
to this). It has been a fun ride and it is hard to let go of the Windows
Mobile client which I think of as 'my baby' (with co-parent Ashley).
There is still so much to do. However, some of the things that I have
been trying to get shipped since September 2006 are finally going out
the door in the upcoming release so I can feel that I have achieved at
least some of what I set out to do.</p>
<p>I'll continue blogging here of course, and I expect to blog quite a lot
about the new release once it is out.</p>
<p>We started the WM client team in July 2006, after the MOJAX (mobile
AJAX) project got killed. That left the core group - the Barrel of
Monkeys - without a home. There were five of us - Steve (PM), Ashley and
I (dev), John (test) and Danny (architect). Rather than each go off to
different jobs we decided to try stick together, and managed to find a
home in local search. We had three months to get the v1.0 product out,
and it was a hit! We got an awful lot of fan mail from that (and if you
were a sender, thanks! We've always appreciated the love :-) ).</p>
<p>After that the original monkey team gradually split up until only Ashley
and I were left, but since December the team has been growing
considerably in size and charter and there are lots of exciting things
in store in the future for the product.</p>
<p>Back in September 2006 I added a couple of features that I thought were
killer, but that never made it into the product. One of those was cell
tower geolocation, which Google since did and which they got a lot of
credit for (damn!). Another will be revealed soon and I've always been
really excited about it; I'll definitely blog about it the moment it
ships publicly. I'm glad to be able to say that I'm leaving Live Search
with all my pet features finally on a ship schedule (in fact I've
offered that as my excuse for being able to leave).</p>
<p>Over the past 1.5 years through what is about to be our fourth release
(almost unprecedented at Microsoft) I've had a lot of fun and worked
with some great people. Live Search for Mobile, in the words of one of
our users, "kicks serious ass"! My new group is almost a spin-off
though, at least in terms of people, so it'll be an easy adjustment. It
will be nice to start with a blank slate again.</p>
<p>Thanks to everyone I've had the pleasure of working with - the Monkey's,
Don and Xuehai on the server team, our incredible tester and soon to be
incredible mom Jenny, our chilled PM Gary, the rock stars over in the
Speech Components Group, all our wonderful dogfooders and users, and all
the new recruits. In particular working with Ashley has always been
fantastic - we are almost of one mind - I'll miss you bud. Remember the
monkey. Aluta continua!</p>
<hr>
<p><a href="images/monkey.png"><img alt="Monkey" src="images/monkey_thumb.png"></a>   <a href="images/monkeys.jpg"><img alt="Monkeys" src="images/monkeys_thumb.jpg" title="monkeys"></a></p>
<hr>
</div>
    </section><footer class="post-meta"><a href="authors/geekraver.html">geekraver</a>

        on

        <time class="post-date" datetime="2008-04-20T05:42:00-07:00">
            2008-04-20 05:42
        </time></footer></article><article class="post post"><header class="post-header"><h2 class="post-title"><a href="posts/why-there-are-no-arco-gas-prices.html">Why There Are no ARCO Gas Prices</a></h2>
    </header><section class="post-excerpt"><div>
<p>We get gas price data from a 3rd party provider. They in turn get the
data from credit card companies. ARCO does not accept credit cards.</p>
<p>This is a great example of where user-contributed data would be
valuable, and I hope that one day we will be able to extend the feature
to include that.</p>
</div>
    </section><footer class="post-meta"><a href="authors/geekraver.html">geekraver</a>

        on

        <time class="post-date" datetime="2008-04-12T05:29:00-07:00">
            2008-04-12 05:29
        </time></footer></article><article class="post post"><header class="post-header"><h2 class="post-title"><a href="posts/were-hiring.html">We're Hiring!</a></h2>
    </header><section class="post-excerpt"><div>
<p>My team is hiring. The job descriptions are below. PM me if you're
interested:</p>
<p>Windows Live Mobile Search team is focused on delivering outstanding
search and local navigation experience on mobile devices.  Our goal is
to put the power of Windows Live Services right in your pocket. We own
creating addictively useful experiences for folks trying to search from
their cell phones. Our mission is to get every one of the mobile
queries. We do this by building best-of-breed browser and full-client
experiences along with a high-performance platform, and by creating
opportunities for users to experience the value through carriers or
direct distribution. We are enabling experiences on your mobile devices
such as Driving directions, 2D maps, GPS based navigation, category
search, product search, browsing detailed maps, finding movie times &amp;
gas prices or just searching anything on the web your are remotely
curious about.  The field is full of stiff competition, but the battle
is far from won for anyone. We delivered award winning Mobile Search
(Live Search) client on Windows Mobile &amp; Blackberry and outstanding
browse experience (m.live.com) that gets consistent praise. We
consistently win reviews against Google and Yahoo.  There is lot more to
do.</p>
<p>In Windows Mobile 7, we are building a world class, rich, immersive and
exploitive app using latest and greatest technologies such as
Silverlight &amp; XAML.  We will enhance Browse experience by leveraging
best of breed technologies available in the industry today.  We are also
building highly scalable backend and high performance developer
platform. Our mission is to get every one of the mobile queries and be
the developer platform for search and local information.</p>
<p>We are looking for developers with the passion to stretch the boundaries
of how people connect with local information.  We’re looking for people
who understand the special constraints of the mobile world and have
experience building dynamic applications for mobile devices. We are
looking for developers who can work on problems unique to mobile
computing, from inception through the end of the product development
life-cycle. This is an excellent opportunity to help drive the flow of
information into users' hands.  The team offers an energetic
environment, solid growth potential, and a great set of people to work
with.</p>
<p>We have Senior SDE and SDE II positions.</p>
<p><strong><u>SDE II (2 Positions)</u></strong></p>
<p>We are looking for SDEs to work on our next generation rich client, to
create high performance platform and highly scalable backend.  You will
be leveraging best-of-breed technologies such as Silverlight, WPF, XAML,
.NET CF and IIS7.</p>
<p>A successful candidate will have:</p>
<p>· Passion for technology and UX</p>
<p>· Experience with the latest mobile technologies</p>
<p>· Solid experience designing, implementing and testing applications
written using C#/C++, .NET CF, ASP.NET. Experience with WPF or
Silverlight is a plus.</p>
<p>· Good communication skills and the ability to approach problems from
the customer’s perspective</p>
<p>· Experience developing and shipping multi-threaded server solutions.</p>
<p>· Commitment to Engineering Excellence</p>
<p>· Bachelor’s degree in CS or equivalent industry experience</p>
<p>· 3+ years of software development experience required.</p>
<p><strong><u>Senior SDE</u></strong></p>
<p>We are looking for a Senior SDE to work on our next generation rich
client, to create high performance platform and highly scalable
backend.  You will be leveraging best-of-breed technologies such as
Silverlight, WPF, XAML, .NET CF and IIS7.</p>
<p>A successful candidate will have:</p>
<p>· Passion for technology and UX</p>
<p>· Experience with the latest mobile technologies</p>
<p>· Solid experience designing, implementing and testing applications
written using C#/C++, .NET CF, ASP.NET. Experience with WPF or
Silverlight is a plus.</p>
<p>· Excellent and pragmatic judgment, good communication skills and the
ability to approach problems from the customer’s perspective</p>
<p>· Experience developing and shipping multi-threaded server solutions.</p>
<p>· Ability to work in cross-collaborative environments with commitment to
Engineering Excellence</p>
<p>· Bachelor’s degree in CS or equivalent industry experience</p>
<p>· 6+ years of software development experience required.</p>
</div>
    </section><footer class="post-meta"><a href="authors/geekraver.html">geekraver</a>

        on

        <time class="post-date" datetime="2008-04-10T05:30:00-07:00">
            2008-04-10 05:30
        </time></footer></article><article class="post post"><header class="post-header"><h2 class="post-title"><a href="posts/the-windows-xp-upgrade.html">The Windows XP "Upgrade"</a></h2>
    </header><section class="post-excerpt"><div>
<p>I have had all the PCs in our house on Vista since Vista RTMed. This
includes my kids computers, and I like the Vista parental controls
(although I wish they were more comprehensive, combining not only
allowed hours of use but quotas as well). I recently wanted to run my
old copy of the game Creatures, and could not get it to install on
Vista. This was sufficiently frustrating that I decided to switch one PC
back to XP. With all the stories in the blogosphere of people
"upgrading" to XP I thought it would be an interesting contrast to go
back.</p>
<p>So on Friday I did this. It's now Sunday night and I'm back on Vista! I
can't agree with those people who think that Vista is inferior to XP. XP
was faster, I'll grant - noticeably so - but that was with a clean
install with no antivirus installed; my Vista boxes all have real-time
AV which adds quote a hit, and I expect the search indexing that goes on
in Vista also adds a hit. In every other respect I like Vista more. I
have a vague temptation to go back to XP on my laptop as I think I could
squeeze more battery life out (I only get  \~90 minutes but that is with
a Pentium-M tablet with discrete graphics, so it isn't that unexpected).</p>
<p>In particular, in the day that I had XP running it froze up three times,
I think the problem was with IE7, not necessarily the OS,  but this
hasn't happened to me on Vista.</p>
<p>The real clincher? Creatures wouldn't install on XP either!</p>
<p>Thankfully I have Windows Home Server running so reverting to Vista was
easy; I still had my old backups.</p>
</div>
    </section><footer class="post-meta"><a href="authors/geekraver.html">geekraver</a>

        on

        <time class="post-date" datetime="2008-03-25T05:32:00-07:00">
            2008-03-25 05:32
        </time></footer></article><article class="post post"><header class="post-header"><h2 class="post-title"><a href="posts/channel-10-video-coming-soon.html">Channel 10 Video coming soon!</a></h2>
    </header><section class="post-excerpt"><p>Last week the <a href="http://on10.net/">Channel 10</a> team visited us and shot
some video of us demoing the Live Search for Mobile client, including
some of the features of our upcoming release (real soon now!) I'm not
sure when the edited video will be available - I guess after the
release - but will update this posting with a link when it is.</p>
    </section><footer class="post-meta"><a href="authors/geekraver.html">geekraver</a>

        on

        <time class="post-date" datetime="2008-03-25T05:31:00-07:00">
            2008-03-25 05:31
        </time></footer></article><article class="post post"><header class="post-header"><h2 class="post-title"><a href="posts/live-search-for-mobile-saves-the-day.html">Live Search for Mobile Saves the Day</a></h2>
    </header><section class="post-excerpt"><p>I love <a href="http://blogs.msdn.com/peterlau/archive/2008/03/24/live-search-for-windows-mobile-saves-the-day.aspx">stories like
this...</a></p>
    </section><footer class="post-meta"><a href="authors/geekraver.html">geekraver</a>

        on

        <time class="post-date" datetime="2008-03-05T05:31:00-08:00">
            2008-03-05 05:31
        </time></footer></article><article class="post post"><header class="post-header"><h2 class="post-title"><a href="posts/connectivity-problems-with-live-search-on-blackberry.html">Connectivity problems with Live Search on Blackberry</a></h2>
    </header><section class="post-excerpt"><div>
<p>I just wanted to share this information that one of our Blackberry devs,
Didier, sent to a customer who was having problems as it may be useful
to others:</p>
<blockquote>
<p>Since Live Search for BlackBerry is distributed as an independent
third party application, it works only if such applications are
allowed to do network requests, which may depend on both your carrier
network policies and your subscription type.</p>
<p>We support three connection modes in Live Search for BlackBerry:
Direct HTTP, BES/MDS and WAP Gateway, but for CDMA devices only Direct
HTTP and BES/MDS are possible (WAP is specific to GPRS/Edge carriers).
BES/MDS is for corporate devices administrated through the company’s
BlackBerry Enterprise Server, Direct HTTP is for individual
subscribers. You can try both modes if you are unsure of your
configuration (in Options &gt; Enter your network configuration
parameters).</p>
<p>But some BlackBerry data plans may be limited to Email &amp; Web browsing
and Live Search will not work in this case.</p>
</blockquote>
</div>
    </section><footer class="post-meta"><a href="authors/geekraver.html">geekraver</a>

        on

        <time class="post-date" datetime="2008-02-24T05:33:00-08:00">
            2008-02-24 05:33
        </time></footer></article><article class="post post"><header class="post-header"><h2 class="post-title"><a href="posts/webkinz-are-evil.html">Webkinz Are Evil</a></h2>
    </header><section class="post-excerpt"><div>
<p>My daughter bought a Webkinz today. These are cheap stuffed animals that
sell at a premium because they have a 'secret code' that allow you to
access the Webkinz website and play games, etc. So of course she wanted
me to set her up to access the site (her PC was locked down to only
allow access to PBS Kids).</p>
<p>We go to the site, sign her up, and then sign in. This launches a new
window running an Adobe Flash app. The URL is not even tied to a domain,
but uses a numeric IP address. After watching it flash 'Loading' for a
while, we get a picture of a green field - and nothing happens.
Meanwhile my wife starts complaining from upstairs that the network has
slowed to a total crawl; not only can't she browse but even the LAN is
pretty hosed, with Outlook frozen up while trying to send an e-mail to
the local Exchange server in the next room.</p>
<p>So I'm listening to this fussing from downstairs and up, and eventually
we kill the Webkinz window - and I hear 'Finally!' from upstairs. We try
the Webkinz app again and more complaints come from upstairs. So not
only is the Webkinz site not working, but it's killing the network.</p>
<p>My daughter is getting pretty upset by this stage. I try various
things - adding the webkinz site and the numeric IP to the trusted zone,
installing the latest version of Flash, even installing Firefox - and
none of it works. But Firefox gives some confirmation that it is the
Webkinz app that is killing the network - I see it continuously trying
to connect to some other numeric IP, over and over in rapid succession.</p>
<p>Finally, to get my daughter off my back and placate the wife, I run the
browser as administrator, and the Webkinz crapplication manages to run.
Of course all the parental controls are now toast and this is not a
sustainable solution.</p>
<p>I find it amazing that these people - who have no scruples about
fleecing kids \$10/pop for their made in China junk -  make a site that
requires such a circumvention of basic security measures to allow kids
in. While at the same time having stupid 'pro-kid' features like not
allowing my daughter to choose the name 'fluffballs' for her pet because
it contains a - gasp - dirty word. Heck, it didn't until they so
conspicuously pointed it out.</p>
<p>Hopefully this is a fad that will fade as quickly as it arrived.</p>
</div>
    </section><footer class="post-meta"><a href="authors/geekraver.html">geekraver</a>

        on

        <time class="post-date" datetime="2008-02-02T05:34:00-08:00">
            2008-02-02 05:34
        </time></footer></article><article class="post post"><header class="post-header"><h2 class="post-title"><a href="posts/scanner-printer-photocopier-eventually.html">Scanner + Printer == Photocopier (eventually)</a></h2>
    </header><section class="post-excerpt"><div>
<p>My wife has been bugging me to make it easier for her to use our scanner
and printer to make copies. I could buy a cheap all-in-one but she
actually needs laser copies, not inkjet, for her hobby of stamp carving
(she can iron a laser-printed image to make a basic transfer). The
scanner and printer are attached to my PC but she wants to make copies
without having to log on to my PC or bother me.</p>
<p>I believe that HP scanners can do this, but I have an Epson Perfection
4490, and if you press the 'Scan to Printer' button on the front it pops
up UI on the PC. It's definitely not a one-step process and the buttons
are a bit of a joke. So I thought I'd write my own app using Window
Image Acquisition to do this. My original plan was to write something
that hooked the button event and then slept in the notification tray,
waking up when the button gets pressed.</p>
<p>Of course, things are never that easy. I wrote the initial code, but the
events never came to me (I've since discovered that the Epson sends a
<strong>wiaEventScanImage2</strong> event instead of a wiaEventScanPrintImage event,
so its possible that was the problem and I may revisit my original code
at some point). Whenever I pressed the button Epson's UI would pop up.
Even more annoying, the first UI was a choice dialog asking me to choose
between Epson Creativity Suite and Epson Scan, even though I had
explicitly configured the scanner software to always use the copy
utility in the creativity suite.</p>
<p>I started mucking about with registry settings but that quickly started
getting ugly and wasn't really helping. So I hacked it. The first thing
I did was to uninstall all the Epson Creativity Suite software, which
was pretty useless anyway. That got rid of the choice dialog so pressing
the button launched Epson Scan. Then I looked at the process that was
running and found it was C:\Windows\twain_32\escndv\escndv.exe
(which itself was confusing as the same app is also installed in
c:\Program Files\Epson). I renamed that app escndv-orig.exe. I then
made my own app in that directory and named it escndv.exe - so now
pressing the button launched my app at last.</p>
<p>Next I had to write the code to scan and print with no UI. That proved a
bit odd too, but eventually I figured it out. The code is shown below.
It's really rough, but it works. I built it as a C# Windows console
project, adding references to the WIA COM DLL and System.Drawing and
System.Drawing.Printing. The app will pop open a dialog on first run to
ask what scanner to use (even if there is only one); after that the
scanner ID is persisted in the app settings. It prints to the default
printer.</p>
<p>This is not completely UI-less - it does pop up a console window briefly
while the scan is in progress - but at least no interaction on the PC is
required.</p>
<p>I plan to extend this later to have one button do an autocrop and scale
to fit. Currently pressing any of the other buttons will launch the
original Epson Scan software.</p>
<pre class="code literal-block"><span></span><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">PrintScan.Properties</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Drawing</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Drawing.Printing</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">WIA</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">PrintScan</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">static</span> <span class="k">void</span> <span class="n">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">new</span> <span class="n">Program</span><span class="p">().</span><span class="n">Run</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">Settings</span> <span class="n">settings</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Settings</span><span class="p">();</span>

        <span class="k">void</span> <span class="n">Configure</span><span class="p">()</span> <span class="c1">// Get the scanner to use via Choose Scanner dialog</span>
        <span class="p">{</span>
            <span class="n">CommonDialogClass</span> <span class="n">class1</span> <span class="p">=</span> <span class="k">new</span> <span class="n">CommonDialogClass</span><span class="p">();</span>
            <span class="n">Device</span> <span class="n">d</span> <span class="p">=</span> <span class="n">class1</span><span class="p">.</span><span class="n">ShowSelectDevice</span><span class="p">(</span><span class="n">WiaDeviceType</span><span class="p">.</span><span class="n">ScannerDeviceType</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">settings</span><span class="p">.</span><span class="n">DeviceID</span> <span class="p">=</span> <span class="n">d</span><span class="p">.</span><span class="n">DeviceID</span><span class="p">;</span>
                <span class="n">settings</span><span class="p">.</span><span class="n">Save</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="kt">bool</span> <span class="n">RunProcess</span><span class="p">(</span><span class="kt">string</span> <span class="n">cmd</span><span class="p">,</span> <span class="kt">string</span> <span class="n">args</span><span class="p">)</span> <span class="c1">// Run some other exe; used to fall back to Epson Scan</span>
        <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="n">Diagnostics</span><span class="p">.</span><span class="n">Process</span> <span class="n">proc</span> <span class="p">=</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">Diagnostics</span><span class="p">.</span><span class="n">Process</span><span class="p">();</span>
            <span class="n">proc</span><span class="p">.</span><span class="n">StartInfo</span><span class="p">.</span><span class="n">FileName</span> <span class="p">=</span> <span class="n">cmd</span><span class="p">;</span>
            <span class="n">proc</span><span class="p">.</span><span class="n">StartInfo</span><span class="p">.</span><span class="n">Arguments</span> <span class="p">=</span> <span class="n">args</span><span class="p">;</span>
            <span class="n">proc</span><span class="p">.</span><span class="n">StartInfo</span><span class="p">.</span><span class="n">UseShellExecute</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">proc</span><span class="p">.</span><span class="n">Start</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">const</span> <span class="kt">string</span> <span class="n">tempFile</span> <span class="p">=</span> <span class="s">@"c:\\temp\\page.bmp"</span><span class="p">;</span>

        <span class="k">void</span> <span class="n">Run</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">settings</span><span class="p">.</span><span class="n">DeviceID</span> <span class="p">==</span> <span class="k">null</span> <span class="p">||</span> <span class="n">settings</span><span class="p">.</span><span class="n">DeviceID</span><span class="p">.</span><span class="n">Length</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
                <span class="n">Configure</span><span class="p">();</span>

            <span class="n">DeviceManager</span> <span class="n">manager</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DeviceManagerClass</span><span class="p">();</span>
            <span class="n">Device</span> <span class="n">d</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">==</span> <span class="p">(</span><span class="s">"/StiEvent:"</span><span class="p">+</span><span class="n">EventID</span><span class="p">.</span><span class="n">wiaEventScanImage2</span><span class="p">))</span> <span class="c1">// I'm surprised it's not EventID.wiaEventScanPrintImage</span>
            <span class="p">{</span>
                <span class="c1">// Find our scanner</span>
                <span class="k">foreach</span> <span class="p">(</span><span class="n">DeviceInfo</span> <span class="n">info</span> <span class="k">in</span> <span class="n">manager</span><span class="p">.</span><span class="n">DeviceInfos</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">DeviceID</span> <span class="p">==</span> <span class="n">settings</span><span class="p">.</span><span class="n">DeviceID</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">d</span> <span class="p">=</span> <span class="n">info</span><span class="p">.</span><span class="n">Connect</span><span class="p">();</span>

                        <span class="c1">// Do the scan and save it to a temp file</span>

                        <span class="n">ImageFile</span> <span class="n">page</span> <span class="p">=</span> <span class="n">d</span><span class="p">.</span><span class="n">Items</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">Transfer</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">Items</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">Formats</span><span class="p">[</span><span class="m">1</span><span class="p">])</span> <span class="k">as</span> <span class="n">ImageFile</span><span class="p">;</span>

                        <span class="k">if</span> <span class="p">(</span><span class="n">File</span><span class="p">.</span><span class="n">Exists</span><span class="p">(</span><span class="n">tempFile</span><span class="p">))</span>
                            <span class="n">File</span><span class="p">.</span><span class="n">Delete</span><span class="p">(</span><span class="n">tempFile</span><span class="p">);</span>

                        <span class="n">page</span><span class="p">.</span><span class="n">SaveFile</span><span class="p">(</span><span class="n">tempFile</span><span class="p">);</span>

                        <span class="c1">// print it to the default printer</span>

                        <span class="n">PrintDocument</span> <span class="n">pd</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PrintDocument</span><span class="p">();</span>
                        <span class="n">pd</span><span class="p">.</span><span class="n">PrintPage</span> <span class="p">+=</span> <span class="k">new</span> <span class="n">PrintPageEventHandler</span><span class="p">(</span><span class="n">pd_PrintPage</span><span class="p">);</span>
                        <span class="n">pd</span><span class="p">.</span><span class="n">Print</span><span class="p">();</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">RunProcess</span><span class="p">(</span><span class="s">@"C:\\Windows\\twain\_32\\escndv\\escndv-orig.exe"</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="m">0</span><span class="p">]+</span><span class="s">" "</span><span class="p">+</span><span class="n">args</span><span class="p">[</span><span class="m">1</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">void</span> <span class="n">pd_PrintPage</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">PrintPageEventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Bitmap</span> <span class="n">bmp</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Bitmap</span><span class="p">(</span><span class="n">tempFile</span><span class="p">);</span>
            <span class="n">GraphicsUnit</span> <span class="n">gu</span> <span class="p">=</span> <span class="n">GraphicsUnit</span><span class="p">.</span><span class="n">Document</span><span class="p">;</span>
            <span class="n">RectangleF</span> <span class="n">bounds</span> <span class="p">=</span> <span class="n">bmp</span><span class="p">.</span><span class="n">GetBounds</span><span class="p">(</span><span class="k">ref</span> <span class="n">gu</span><span class="p">);</span>
            <span class="n">e</span><span class="p">.</span><span class="n">Graphics</span><span class="p">.</span><span class="n">DrawImage</span><span class="p">(</span><span class="n">bmp</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">gu</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
</div>
    </section><footer class="post-meta"><a href="authors/geekraver.html">geekraver</a>

        on

        <time class="post-date" datetime="2008-02-01T05:35:00-08:00">
            2008-02-01 05:35
        </time></footer></article><article class="post post"><header class="post-header"><h2 class="post-title"><a href="posts/why-there-is-no-integration-with-outlook-mobile-contacts.html">Why There Is No Integration With Outlook Mobile Contacts</a></h2>
    </header><section class="post-excerpt"><div>
<p>We often get asked why we don't have a menu item in the Contacts app on
the phone to map a contact, but Google does. The comments can sometimes
be quite disparaging (like what's wrong with you people in Redmond,
anyway?). So here is the tale, told by an idiot, without much sound or
fury.</p>
<p>Early in 2006 I wrote the code to hook into Contacts. It worked pretty
well, and we planned to ship this in our v2 release in July '07. Shortly
before our release date, Google released an update to their Windows
Mobile map app, and they had the feature. So we immediately decided to
test to make sure we played nicely together.</p>
<p>Unfortunately, we found that if you installed GMM and then installed
Live Search, and then you selected the 'Map in Google Maps' menu option,
instead of GMM starting, Live Search would start. Pretty cool, except
there was no way we could ship like that! Imagine the press we would get
in the blogosphere - people would think we were maliciously taking over
GMM's contact mapping feature.</p>
<p>I spent nearly a week trying to figure out what was going on. In the
end, I found that the code sample from the Windows Mobile SDK that I
based my menu extension DLL on had a bug, and I had cut and paste that
bug into our own code. So I fixed the bug - but we still had the
problem. It quickly became obvious that Google's programmers had done
exactly the same thing, and they had the same bug!</p>
<p>So we put the feature on ice (which everyone agreed was the right thing
to do), and I contacted a friend of mine who works at Google and asked
her to pass on a message to the GMM developers, telling them that they
had this bug and how to fix it. Some time later I got a message back
saying they had fixed the bug in their code, but it was too late for us
to include the feature in the release. Some time in the future we'll
finally release our version.</p>
<p>So let this be a cautionary tale - don't assume code samples you get off
MSDN, in and SDK, or anywhere else for that matter, don't have bugs.
This particular bug only bit if you loaded more than one extension DLL
into Contacts, so the person who wrote the code sample never noticed,
and nor did Google.</p>
<p>I've always wondered though - what would have happened if we had shipped
first?</p>
<p>For those who are interested, the bug was in the return value of
QueryContextMenu. The MSDN sample returns S_OK, which is not the right
response. Here is the correct documentation from MSDN:</p>
<blockquote>
<p>"If successful, returns an <strong>HRESULT</strong> value that has its severity
value set to SEVERITY_SUCCESS and its code value set to the offset of
the largest command identifier that was assigned, plus one. For
example, assume that <em>idCmdFirst</em> is set to 5 and you add three items
to the menu with command identifiers of 5, 7, and 8. The return value
should be MAKE_HRESULT(SEVERITY_SUCCESS, 0, 8 - 5 + 1). Otherwise,
it returns an OLE error value."</p>
</blockquote>
</div>
    </section><footer class="post-meta"><a href="authors/geekraver.html">geekraver</a>

        on

        <time class="post-date" datetime="2008-02-01T05:34:00-08:00">
            2008-02-01 05:34
        </time></footer></article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-4.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2.html" rel="next">Older posts</a>
            </li>
        </ul></nav><script>var disqus_shortname="randomforest";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script></main><footer class="site-footer clearfix"><section class="poweredby">Contents © 2017         <a href="mailto:gram@geekraver.com">Graham Wheeler</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </section></footer>
</div>

    <script type="text/javascript" src="assets/js/jquery.js"></script><script type="text/javascript" src="assets/js/jquery.fitvids.js"></script><script type="text/javascript" src="assets/js/index.js"></script><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-67535606-1', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
